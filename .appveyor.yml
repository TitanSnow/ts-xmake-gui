version: No.{build}
skip_tags: false
branches:
  only:
    - newnt-single-debug
clone_depth: 1
platform: x86
install:
  - cmd: pip install pyinstaller
  - ps: Invoke-Webrequest 'https://github.com/upx/upx/releases/download/v3.93/upx393w.zip' -OutFile 'upx393w.zip'
  - ps: Expand-Archive 'upx393w.zip'
  - ps: Invoke-Expression (Invoke-Webrequest 'https://raw.githubusercontent.com/tboox/xmake/master/scripts/get.ps1' -UseBasicParsing).Content
  - ps: Copy-Item -Recurse "$HOME\xmake" .
before_build:
  - cmd: git submodule update --init
build_script:
  - cmd: cd winpty
  - cmd: vcbuild.bat --msvc-platform Win32
  - cmd: cd ..
  - ps: Copy-Item winpty\src\Release\Win32\winpty-agent.exe,winpty\src\Release\Win32\winpty.dll .
after_build:
  - cmd: pyinstaller -F --add-binary winpty-agent.exe;. --add-data xmake;. ts-xmake-gui.py --upx-dir upx393w\upx393w
artifacts:
  - path: dist\ts-xmake-gui.exe
    name: ts-xmake-gui-newnt
deploy:
  - provider: GitHub
    artifact: ts-xmake-gui-newnt
    draft: true
    description: 'temp'
    on:
      appveyor_repo_tag: true
    auth_token:
      secure: i6fhYJ/A8hJC3+zb+jwRNljh5pGKxhC03D5Gla6EowVBLaFolxA8X3ZeXE0aE0pZ
